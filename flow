[{"id":"1a99e199.a73c6e","type":"subflow","name":"Network Map","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[],"env":[]},{"id":"c8ef68ad.706438","type":"mqtt in","z":"1a99e199.a73c6e","name":"zigbee2mqtt/out","topic":"zigbee2mqtt/bridge/networkmap/graphviz","qos":"2","broker":"8a885867.5e4a58","x":120,"y":140,"wires":[["f86291d.37a417"]]},{"id":"1c696d9d.5a1552","type":"http in","z":"1a99e199.a73c6e","name":"","url":"/adminpanelapi/networkmap/graphviz","method":"get","upload":false,"swaggerDoc":"","x":200,"y":200,"wires":[["e58b6575.9a5128"]]},{"id":"435dc930.73eee8","type":"http response","z":"1a99e199.a73c6e","name":"","x":610,"y":200,"wires":[]},{"id":"e58b6575.9a5128","type":"function","z":"1a99e199.a73c6e","name":"get from flow","func":"var networkmap = flow.get('networkmap');\n\nmsg.payload = networkmap;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":200,"wires":[["435dc930.73eee8"]]},{"id":"642e9986.8c9e78","type":"inject","z":"1a99e199.a73c6e","name":"","topic":"","payload":"graphviz","payloadType":"str","repeat":"30","crontab":"","once":true,"onceDelay":0.1,"x":120,"y":80,"wires":[["4ae3a043.4b667"]]},{"id":"f86291d.37a417","type":"function","z":"1a99e199.a73c6e","name":"store in flow","func":"flow.set('networkmap',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":140,"wires":[[]]},{"id":"4ae3a043.4b667","type":"mqtt out","z":"1a99e199.a73c6e","name":"zigbee2mqtt/in","topic":"zigbee2mqtt/bridge/networkmap","qos":"","retain":"","broker":"84cedd0a.3e618","x":280,"y":80,"wires":[]},{"id":"da176500.1799d8","type":"http in","z":"1a99e199.a73c6e","name":"","url":"/adminpanelapi/networkmap/viz/:engine","method":"get","upload":false,"swaggerDoc":"","x":210,"y":260,"wires":[["8f10a59b.afdac8"]]},{"id":"f0485728.faf6f8","type":"http response","z":"1a99e199.a73c6e","name":"","statusCode":"","headers":{},"x":810,"y":260,"wires":[]},{"id":"61c7281c.2135a8","type":"function","z":"1a99e199.a73c6e","name":"generate viz html","func":"var html = `<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>NetworkMap</title>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js\"></script>\n    <script src='https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.5.0/dist/svg-pan-zoom.min.js'></script>\n    <style>\n    svg {\n      width: 100% !important;\n      height: 100% !important;\n      min-width: 100% !important;\n      min-height: 80% !important;\n    }\n    </style>\n  </head>\n  <body>\n    <div id=\"output\"></div>\n    \n    <script>\n        var graphData = '${(flow.get('networkmap')).replace(/(\\r\\n|\\n|\\r)/gm,\"\")}';\n        var vizOptions = { format: 'svg', engine: '${msg.engine}'}\n        var graph = document.querySelector(\"#output\");\n        var svg = graph.querySelector(\"svg\");\n        if (svg) {\n          graph.removeChild(svg);\n        }        \n\n        var viz = new Viz();\n\n        viz.renderSVGElement(graphData, vizOptions)\n          .then(function(svg) {\n            svg.id = \"svg_output\";\n            graph.appendChild(svg);              \n            \n            panZoom = svgPanZoom(svg, {\n              zoomEnabled: true,\n              controlIconsEnabled: true,\n              contain: true,\n              center: true,\n              minZoom: 0.1\n            });\n\n            svg.addEventListener('paneresize', function(e) {\n              panZoom.resize();\n            }, false);\n            window.addEventListener('resize', function(e) {\n              panZoom.resize();\n            });\n          })\n          .catch(error => {\n            // Create a new Viz instance (@see Caveats page for more info)\n            viz = new Viz();\n  \n            // Possibly display the error\n            console.error(error);\n          });\n    </script>\n  </body>\n</html>\n`\n\nmsg.payload = html;\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":260,"wires":[["f0485728.faf6f8"]]},{"id":"8f10a59b.afdac8","type":"function","z":"1a99e199.a73c6e","name":"set engine","func":"var availableEngines = ['circo', 'dot', 'fdp', 'neato', 'osage', 'twopi']\nif(availableEngines.includes(msg.req.params.engine)) { msg.engine = msg.req.params.engine }\nelse { msg.engine = 'dot' }\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":260,"wires":[["61c7281c.2135a8"]]},{"id":"1d7b4805.061ef8","type":"subflow","name":"Pairing Notifications","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"7c539072.f0238","type":"mqtt in","z":"1d7b4805.061ef8","name":"zigbee2mqtt/logging","topic":"zigbee2mqtt/bridge/log","qos":"2","broker":"8a885867.5e4a58","x":290,"y":140,"wires":[["352e5a08.07b486"]]},{"id":"352e5a08.07b486","type":"json","z":"1d7b4805.061ef8","name":"","property":"payload","action":"","pretty":false,"x":450,"y":140,"wires":[["8953d92b.7b5338","80dabe8d.f5809","ddcb3d5.a04bec"]]},{"id":"29ffdec1.da6022","type":"ui_toast","z":"1d7b4805.061ef8","position":"top right","displayTime":"30","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":950,"y":80,"wires":[]},{"id":"8953d92b.7b5338","type":"function","z":"1d7b4805.061ef8","name":"Notification","func":"if(msg.payload.type == \"pairing\" && msg.payload.message == \"connecting with device\") {\n\nmsg.payload = (\"A device is attempting to pair...\");\n\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":750,"y":80,"wires":[["29ffdec1.da6022"]]},{"id":"f6eb68ac.9792f8","type":"comment","z":"1d7b4805.061ef8","name":"Notification","info":"","x":110,"y":140,"wires":[]},{"id":"56165654.079a08","type":"comment","z":"1d7b4805.061ef8","name":"Pairing","info":"","x":590,"y":80,"wires":[]},{"id":"9077a661.851a38","type":"ui_toast","z":"1d7b4805.061ef8","position":"top right","displayTime":"10","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":950,"y":200,"wires":[]},{"id":"80dabe8d.f5809","type":"function","z":"1d7b4805.061ef8","name":"Notification","func":"if(msg.payload.type == \"device_connected\") {\n\nmsg.payload = (\"Device paired successfully: \" + msg.payload.message);\n\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":750,"y":200,"wires":[["9077a661.851a38"]]},{"id":"41be84a2.e569ec","type":"comment","z":"1d7b4805.061ef8","name":"Paired","info":"","x":590,"y":200,"wires":[]},{"id":"a63550ce.fbdf3","type":"ui_toast","z":"1d7b4805.061ef8","position":"top right","displayTime":"30","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":1030,"y":140,"wires":[]},{"id":"ddcb3d5.a04bec","type":"function","z":"1d7b4805.061ef8","name":"Notification","func":"if(msg.payload.type == \"pairing\" && msg.payload.message == \"device incoming\") {\n\nmsg.payload = (\"A device is incoming or repairing...\");\n\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":830,"y":140,"wires":[["a63550ce.fbdf3"]]},{"id":"5f9d85e9.88c87c","type":"comment","z":"1d7b4805.061ef8","name":"Incoming or Repairing","info":"","x":640,"y":140,"wires":[]},{"id":"ea59bfdb.8bd1a","type":"subflow","name":"Devices","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"44134a2d.6096f4","type":"mqtt in","z":"ea59bfdb.8bd1a","name":"zigbee2mqtt/out devices","topic":"zigbee2mqtt/bridge/log","qos":"2","broker":"8a885867.5e4a58","x":350,"y":140,"wires":[["4cd778c1.afefe8"]]},{"id":"e413c9ff.560408","type":"ui_template","z":"ea59bfdb.8bd1a","group":"5f1e9449.9c427c","name":"","order":0,"width":"12","height":"12","format":"<table>\n<tr>\n    <td><B><U>Name:</U></B></td>\n    <td><B><U>ieeeAddr:</U></B></td>\n    <td><B><U>Model:</U></B></td>\n    <td><B><U>Type:</U></B></td>\n</tr>\n  <tr ng-repeat=\"obj in msg.payload.message\">\n    <td>{{ obj.friendly_name }}</td>\n    <td>{{ obj.ieeeAddr }}</td>\n    <td>{{ obj.model }}</td>\n    <td>{{ obj.type }}</td>\n  </tr>\n\n</table>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":660,"y":140,"wires":[[]]},{"id":"f1b14ea3.71894","type":"mqtt out","z":"ea59bfdb.8bd1a","name":"zigbee2mqtt/in devices","topic":"zigbee2mqtt/bridge/config/devices","qos":"","retain":"","broker":"8a885867.5e4a58","x":580,"y":60,"wires":[]},{"id":"5b185e9e.1a8df","type":"inject","z":"ea59bfdb.8bd1a","name":"Request Device List","topic":"","payload":"","payloadType":"date","repeat":"4","crontab":"","once":true,"onceDelay":0.1,"x":360,"y":60,"wires":[["f1b14ea3.71894"]]},{"id":"41cadfd7.856a7","type":"comment","z":"ea59bfdb.8bd1a","name":"Request Device List","info":"","x":130,"y":60,"wires":[]},{"id":"6d63d2ef.f559dc","type":"comment","z":"ea59bfdb.8bd1a","name":"Receive Device List","info":"","x":130,"y":140,"wires":[]},{"id":"4cd778c1.afefe8","type":"json","z":"ea59bfdb.8bd1a","name":"","property":"payload","action":"","pretty":false,"x":530,"y":140,"wires":[["e413c9ff.560408","4658517e.fd2fb","46000163.11c15"]]},{"id":"b5ae9128.7ea9","type":"http in","z":"ea59bfdb.8bd1a","name":"","url":"/adminpanelapi/devicelist","method":"get","upload":false,"swaggerDoc":"","x":530,"y":220,"wires":[["9290db3c.126c28"]]},{"id":"4658517e.fd2fb","type":"function","z":"ea59bfdb.8bd1a","name":"Store Data","func":"flow.set('devicelist',msg.payload);","outputs":1,"noerr":0,"x":310,"y":220,"wires":[[]]},{"id":"491af376.8f7a9c","type":"http response","z":"ea59bfdb.8bd1a","name":"","x":870,"y":220,"wires":[]},{"id":"9290db3c.126c28","type":"function","z":"ea59bfdb.8bd1a","name":"Get Data","func":"var devicelist = flow.get('devicelist');\nmsg.payload = devicelist;\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":220,"wires":[["491af376.8f7a9c"]]},{"id":"65bb417c.fc4e6","type":"comment","z":"ea59bfdb.8bd1a","name":"HTTP JSON API","info":"","x":120,"y":220,"wires":[]},{"id":"46000163.11c15","type":"function","z":"ea59bfdb.8bd1a","name":"Store Globally","func":"global.set('zigbee2mqttdevicelist',msg.payload.message);\nreturn msg;","outputs":1,"noerr":0,"x":890,"y":120,"wires":[[]]},{"id":"5f1e9449.9c427c","type":"ui_group","z":"ea59bfdb.8bd1a","name":"Devices","tab":"1abd534e.8acd2d","order":1,"disp":true,"width":"12","collapse":false},{"id":"eb953e39.83cf5","type":"subflow","name":"Status","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"a27f4103.e5a26","type":"mqtt in","z":"eb953e39.83cf5","name":"zigbee2mqtt/bridge state","topic":"zigbee2mqtt/bridge/state","qos":"2","broker":"8a885867.5e4a58","x":270,"y":80,"wires":[["28477799.484458"]]},{"id":"28477799.484458","type":"function","z":"eb953e39.83cf5","name":"Format Data","func":"flow.set('bridgestate',msg.payload);\nvar bridgestate = flow.get('bridgestate');\nmsg.payload = bridgestate;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":80,"wires":[["b41de89b.565a78"]]},{"id":"10df6b36.bd5205","type":"ui_template","z":"eb953e39.83cf5","group":"57d519f8.a305e8","name":"","order":0,"width":"6","height":"2","format":"<style>\n    {{msg.style}}\n</style>\n\n<table>\n  <tr>\n    <td>Bridge</td>\n    <td>{{msg.payload.bridgestate}}</td>\n  </tr>\n  <tr>\n    <td>Devices</td>\n    <td>{{msg.payload.numberofdevices}}</td>\n  </tr>\n</table>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":660,"y":140,"wires":[[]]},{"id":"e37989b7.df9918","type":"function","z":"eb953e39.83cf5","name":"Format Data","func":"var bridgestate = flow.get('bridgestate');\nvar devicelist = global.get('zigbee2mqttdevicelist');\nmsg.payload = {}\nmsg.payload.bridgestate = bridgestate;\nmsg.payload.numberofdevices = devicelist.length;\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":140,"wires":[["10df6b36.bd5205"]]},{"id":"1ae121d3.74944e","type":"inject","z":"eb953e39.83cf5","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":true,"onceDelay":0.1,"x":350,"y":140,"wires":[["e37989b7.df9918"]]},{"id":"b41de89b.565a78","type":"debug","z":"eb953e39.83cf5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":610,"y":80,"wires":[]},{"id":"34472336.43332c","type":"comment","z":"eb953e39.83cf5","name":"Get state","info":"","x":80,"y":80,"wires":[]},{"id":"3cafcd7a.adde12","type":"comment","z":"eb953e39.83cf5","name":"Update Web UI on Interval","info":"","x":130,"y":140,"wires":[]},{"id":"d0c8e5b0.6f5618","type":"http in","z":"eb953e39.83cf5","name":"","url":"/adminpanelapi/state","method":"get","upload":false,"swaggerDoc":"","x":270,"y":220,"wires":[["53d4ae5c.26443"]]},{"id":"aea17885.ddab18","type":"http response","z":"eb953e39.83cf5","name":"","x":590,"y":220,"wires":[]},{"id":"53d4ae5c.26443","type":"function","z":"eb953e39.83cf5","name":"Get Data","func":"var bridgestate = flow.get('bridgestate');\nmsg.payload = bridgestate;\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":220,"wires":[["aea17885.ddab18"]]},{"id":"277b0bb4.f5cc74","type":"comment","z":"eb953e39.83cf5","name":"HTTP API","info":"","x":80,"y":220,"wires":[]},{"id":"57d519f8.a305e8","type":"ui_group","z":"","name":"Status","tab":"1abd534e.8acd2d","order":2,"disp":true,"width":"6","collapse":false},{"id":"54ad4eab.6ef1d","type":"subflow","name":"Logging Level","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"e31f7d2f.7ea5b","type":"ui_dropdown","z":"54ad4eab.6ef1d","name":"","label":"","place":"Select option","group":"10698432.33b26c","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Info","value":"info","type":"str"},{"label":"Debug","value":"debug","type":"str"},{"label":"Warn","value":"warn","type":"str"},{"label":"Error","value":"error","type":"str"}],"payload":"","topic":"","x":120,"y":60,"wires":[["3cd6a494.7a5b8c"]]},{"id":"3cd6a494.7a5b8c","type":"mqtt out","z":"54ad4eab.6ef1d","name":"zigbee2mqtt/in Logging Level","topic":"zigbee2mqtt/bridge/config/log_level","qos":"","retain":"","broker":"84cedd0a.3e618","x":380,"y":60,"wires":[]},{"id":"10698432.33b26c","type":"ui_group","z":"54ad4eab.6ef1d","name":"Logging Level","tab":"1abd534e.8acd2d","order":4,"disp":true,"width":"6","collapse":false},{"id":"66127db2.ee92d4","type":"subflow","name":"Remove Device","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"4b346915.470798","type":"ui_text_input","z":"66127db2.ee92d4","name":"","label":"Device Name","group":"a995e9dc.a91998","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"5","topic":"","x":300,"y":60,"wires":[["7a57a34b.89ee3c"]]},{"id":"cafd257a.74a908","type":"mqtt out","z":"66127db2.ee92d4","name":"zigbee2mqtt/in Remove","topic":"zigbee2mqtt/bridge/config/remove","qos":"","retain":"","broker":"84cedd0a.3e618","x":1190,"y":60,"wires":[]},{"id":"1528cb2a.ae6655","type":"function","z":"66127db2.ee92d4","name":"Format Data","func":"flow.set('remove',msg.payload.remove);","outputs":1,"noerr":0,"x":650,"y":60,"wires":[[]]},{"id":"7a57a34b.89ee3c","type":"change","z":"66127db2.ee92d4","name":"change msg old","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.remove","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":60,"wires":[["1528cb2a.ae6655"]]},{"id":"769b7e34.51a86","type":"function","z":"66127db2.ee92d4","name":"Format Data","func":"var remove = flow.get('remove');\nif (typeof remove !== 'undefined' && remove !== null && remove !== \"\"){\nmsg.payload = remove;\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":970,"y":60,"wires":[["cafd257a.74a908"]]},{"id":"8d3b7704.621c88","type":"ui_button","z":"66127db2.ee92d4","name":"","group":"a995e9dc.a91998","order":5,"width":0,"height":0,"passthru":false,"label":"Remove","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":820,"y":60,"wires":[["769b7e34.51a86","a64f6421.ecaec8"]]},{"id":"782d6707.a1fa18","type":"comment","z":"66127db2.ee92d4","name":"Remove Device","info":"","x":120,"y":60,"wires":[]},{"id":"16bf5dc8.3baf42","type":"mqtt in","z":"66127db2.ee92d4","name":"zigbee2mqtt/logging","topic":"zigbee2mqtt/bridge/log","qos":"2","broker":"8a885867.5e4a58","x":290,"y":120,"wires":[["a1d4e19e.ec034"]]},{"id":"a1d4e19e.ec034","type":"json","z":"66127db2.ee92d4","name":"","property":"payload","action":"","pretty":false,"x":450,"y":120,"wires":[["621adf4d.0b001"]]},{"id":"65f8d1a5.c073f","type":"ui_toast","z":"66127db2.ee92d4","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":790,"y":120,"wires":[]},{"id":"621adf4d.0b001","type":"function","z":"66127db2.ee92d4","name":"Notification","func":"if(msg.payload.type == 'device_removed') {\nvar remove = flow.get('remove');\nif (typeof remove !== 'undefined' && remove !== null && remove !== \"\"){\nmsg.payload = (\"Deviced removed: \" + msg.payload.message);\n\n// Reset field\n//remove = \"\";\n//flow.set('remove',msg.payload.message);\n\nreturn msg;\n}\n}\n\n","outputs":1,"noerr":0,"x":590,"y":120,"wires":[["65f8d1a5.c073f"]]},{"id":"e6de2dc2.91635","type":"comment","z":"66127db2.ee92d4","name":"Notification","info":"","x":110,"y":120,"wires":[]},{"id":"50586da9.e96284","type":"ui_toast","z":"66127db2.ee92d4","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":1210,"y":120,"wires":[]},{"id":"a64f6421.ecaec8","type":"function","z":"66127db2.ee92d4","name":"Notification","func":"var remove = flow.get('remove');\nif (typeof remove === 'undefined' || remove === null || remove === \"\"){\nmsg.payload = \"Enter a device to remove\";\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":1010,"y":120,"wires":[["50586da9.e96284"]]},{"id":"a995e9dc.a91998","type":"ui_group","z":"66127db2.ee92d4","name":"Remove Device","tab":"1abd534e.8acd2d","order":5,"disp":true,"width":"6","collapse":false},{"id":"8a885867.5e4a58","type":"mqtt-broker","z":"","name":"MQTT","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"domoticz/bridge/state","birthQos":"0","birthPayload":"online","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"8855af76.4cb4a","type":"subflow","name":"Permit Join","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"81f256f0.485628","type":"ui_dropdown","z":"8855af76.4cb4a","name":"","label":"","place":"Select option","group":"388e5037.ef51f","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Allow","value":"true","type":"str"},{"label":"Deny","value":"false","type":"str"}],"payload":"","topic":"","x":90,"y":40,"wires":[["6bcd3c99.746e14","63ea905e.61c51"]]},{"id":"6bcd3c99.746e14","type":"mqtt out","z":"8855af76.4cb4a","name":"zigbee2mqtt/in Join","topic":"zigbee2mqtt/bridge/config/permit_join","qos":"","retain":"","broker":"84cedd0a.3e618","x":270,"y":40,"wires":[]},{"id":"26c55d9a.cdc072","type":"ui_toast","z":"8855af76.4cb4a","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":450,"y":100,"wires":[]},{"id":"63ea905e.61c51","type":"function","z":"8855af76.4cb4a","name":"Notification","func":"if (typeof msg.payload !== 'undefined' && msg.payload !== null && msg.payload !== \"\"){\nif (msg.payload == \"false\"){\n    msg.payload = \"Permit join: Deny\";\n}\nif (msg.payload == \"true\"){\n    msg.payload = \"Permit join: Allow\";\n}\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":250,"y":100,"wires":[["26c55d9a.cdc072"]]},{"id":"388e5037.ef51f","type":"ui_group","z":"","name":"Permit Join","tab":"1abd534e.8acd2d","order":3,"disp":true,"width":"6","collapse":false},{"id":"f336b63a.eef138","type":"subflow","name":"Rename Device","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"1f983ab6.5013b5","type":"ui_text_input","z":"f336b63a.eef138","name":"","label":"Old Name","group":"38a11516.15e77a","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"5","topic":"","x":120,"y":140,"wires":[["5d64135e.4c33bc"]]},{"id":"6b63642e.b87e8c","type":"ui_text_input","z":"f336b63a.eef138","name":"","label":"New Name","group":"38a11516.15e77a","order":4,"width":0,"height":0,"passthru":true,"mode":"text","delay":"5","topic":"","x":130,"y":200,"wires":[["20c8b784.c10608"]]},{"id":"4fec9276.e0007c","type":"mqtt out","z":"f336b63a.eef138","name":"zigbee2mqtt/in Rename","topic":"zigbee2mqtt/bridge/config/rename","qos":"","retain":"","broker":"84cedd0a.3e618","x":1010,"y":140,"wires":[]},{"id":"bc5c3331.eb524","type":"function","z":"f336b63a.eef138","name":"Format Data","func":"flow.set('oldname',msg.payload.old);","outputs":1,"noerr":0,"x":470,"y":140,"wires":[[]]},{"id":"5d64135e.4c33bc","type":"change","z":"f336b63a.eef138","name":"change msg old","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.old","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":140,"wires":[["bc5c3331.eb524"]]},{"id":"20c8b784.c10608","type":"change","z":"f336b63a.eef138","name":"change msg new","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.new","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":200,"wires":[["d00bdd6e.bde67"]]},{"id":"4785a075.0aef4","type":"function","z":"f336b63a.eef138","name":"Format Data","func":"var oldname = flow.get('oldname');\nvar newname = flow.get('newname');\n\nif (typeof oldname !== 'undefined' && oldname !== null && oldname !== \"\" && typeof newname !== 'undefined' && newname !== null && newname !== \"\"){\nmsg.payload = {\"old\": oldname, \"new\": newname}\n\n// Reset fields\noldname = \"\";\nnewname = \"\";\nflow.set('oldname',msg.payload.old);\nflow.set('newname',msg.payload.new);\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":790,"y":140,"wires":[["4fec9276.e0007c"]]},{"id":"d00bdd6e.bde67","type":"function","z":"f336b63a.eef138","name":"Format Data","func":"flow.set('newname',msg.payload.new);","outputs":1,"noerr":0,"x":490,"y":200,"wires":[[]]},{"id":"a0517470.1e3388","type":"ui_button","z":"f336b63a.eef138","name":"","group":"38a11516.15e77a","order":5,"width":0,"height":0,"passthru":false,"label":"Rename","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":640,"y":140,"wires":[["4785a075.0aef4","ea62574e.aa1f08"]]},{"id":"ed79453a.5a2f28","type":"ui_toast","z":"f336b63a.eef138","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":850,"y":200,"wires":[]},{"id":"ea62574e.aa1f08","type":"function","z":"f336b63a.eef138","name":"Notification","func":"var oldname = flow.get('oldname');\nvar newname = flow.get('newname');\n\nif (typeof oldname !== 'undefined' && oldname !== null && oldname !== \"\" && typeof newname !== 'undefined' && newname !== null && newname !== \"\"){\nmsg.payload = (\"Rename Device: \" + oldname + \" to \" + newname);\nreturn msg;\n} else {\nmsg.payload = \"Enter device to rename\";\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":670,"y":200,"wires":[["ed79453a.5a2f28"]]},{"id":"38a11516.15e77a","type":"ui_group","z":"","name":"Rename Device","tab":"1abd534e.8acd2d","order":6,"disp":true,"width":"6","collapse":false},{"id":"84cedd0a.3e618","type":"mqtt-broker","z":"","name":"MQTT","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"1abd534e.8acd2d","type":"ui_tab","z":"","name":"Zigbee2MQTT Admin Panel","icon":"dashboard"},{"id":"af707f51.276ca","type":"tab","label":"Zigbee2MQTT Admin Panel","disabled":false,"info":""},{"id":"c3f8822a.f23f6","type":"subflow:f336b63a.eef138","z":"af707f51.276ca","name":"","x":120,"y":120,"wires":[]},{"id":"591e6a46.6c2834","type":"subflow:8855af76.4cb4a","z":"af707f51.276ca","name":"","x":100,"y":80,"wires":[]},{"id":"a6b89279.15b65","type":"subflow:66127db2.ee92d4","z":"af707f51.276ca","name":"","x":120,"y":160,"wires":[]},{"id":"d930f04d.53be2","type":"comment","z":"af707f51.276ca","name":"Function","info":"","x":100,"y":40,"wires":[]},{"id":"1ad972cb.87849d","type":"subflow:54ad4eab.6ef1d","z":"af707f51.276ca","name":"","x":110,"y":200,"wires":[]},{"id":"af7988d9.715dc8","type":"subflow:eb953e39.83cf5","z":"af707f51.276ca","name":"","x":90,"y":240,"wires":[]},{"id":"1d7bef52.992381","type":"subflow:ea59bfdb.8bd1a","z":"af707f51.276ca","name":"","x":90,"y":280,"wires":[]},{"id":"d025c4c4.7fcec8","type":"comment","z":"af707f51.276ca","name":"Other","info":"","x":350,"y":40,"wires":[]},{"id":"253343d1.b4ea6c","type":"subflow:1d7b4805.061ef8","z":"af707f51.276ca","name":"","x":390,"y":80,"wires":[]},{"id":"9dfc84d2.36f5f8","type":"subflow:1a99e199.a73c6e","z":"af707f51.276ca","name":"","env":[],"x":370,"y":140,"wires":[]}]
